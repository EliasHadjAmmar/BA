---
title: "extinction events"
output: html_document
date: "2023-01-16"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = '~/GitHub/BA')
library(tidyverse)
library(haven)
```

## Identifying family extinctions

```{r data import}
people <- read_dta("build/input/families_rulers_imputed.dta")
people$terr_id <- na_if(people$terr_id, '')

rulers <- people %>% 
  filter(!is.na(terr_id))

territories <- read.csv("build/input/territories.csv")
```

Okay. I have a list of all rulers. How do I get all extinction events? What *is* an extinction event, really?

I want all rulers whose successor is not from their own family.

---
Idea 1: start out from the `territories` data. This is a dataset at the city-year level. Make a list of every instance of a city switching `terr_id` between two time points. A city switch consists of a `city_id`, a `time_point`, the old `terr_id`, the new `terr_id`, and the `type_change`. To be clear, a city switch can be due to extinction, due to conquest, Then take this list of city-year observations over to the `rulers` data and 


So. The `territories` data actually already codes extinction of lineage. I just need to filter for `type_change == 3`. Then I get all city-year observations in which a new family replaced an extinct one. Let's do that first.

```{r get post observations}
city_events <- territories %>% 
  filter(type_change == 3)

view(city_events)
```

Oh yeah, right. For each family extinction (a family-level event), this will give me *multiple* city-level events. First, because for each extinction, multiple cities change hands. Second, because the event shows up for all years afterwards until a new event happens, I also get all city-year observations *after* the city event.